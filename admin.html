<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>WhitePack — Professional Catalogue</title>
<link rel="preconnect" href="https://wa.me">

<style>
:root{
 --bg:#f4f7f6;
 --accent:#2e7d32;
 --accent2:#66bb6a;
 --dark:#1b5e20;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui;background:var(--bg)}

header{
 background:linear-gradient(90deg,#a5d6a7,#2e7d32);
 padding:16px;
 display:flex;
 align-items:center;
 gap:14px;
 flex-wrap:wrap;
 position:sticky;
 top:0;
 z-index:100;
}
.logo{
 width:54px;height:44px;
 background:var(--dark);
 border-radius:10px;
 display:flex;
 align-items:center;
 justify-content:center;
 color:#fff;font-weight:700;
}
.topbar{margin-left:auto;font-size:13px}

.container{padding:24px}

.section-title{font-size:22px;margin-bottom:12px;font-weight:700}

.grid{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
 gap:20px;
}

.card{
 background:#fff;
 border-radius:16px;
 padding:12px;
 box-shadow:0 8px 22px rgba(0,0,0,.08);
 display:flex;
 flex-direction:column;
 gap:8px;
}

.card img{
 width:100%;
 height:180px;
 object-fit:cover;
 border-radius:12px;
}

.price{font-weight:700;color:var(--accent)}

.qty-row{display:flex;gap:8px;align-items:center}

.qty-box{display:flex;gap:4px}

.qty-box button{
 width:26px;height:28px;border:none;
 background:#e2e8f0;border-radius:6px;cursor:pointer
}

.qty-box input{
 width:45px;text-align:center;
 border:1px solid #ddd;border-radius:6px
}

.add-btn{
 flex:1;
 background:linear-gradient(90deg,var(--accent2),var(--accent));
 border:none;color:#fff;padding:6px;border-radius:8px;
 cursor:pointer
}

/* CART PANEL */
.cart{
 position:fixed;
 right:20px;
 bottom:20px;
 width:340px;
 background:#fff;
 border-radius:18px;
 box-shadow:0 15px 35px rgba(0,0,0,.2);
 padding:16px;
 z-index:999;
 display:flex;
 flex-direction:column;
 gap:10px;
}

.cart h3{
 margin:0;
}

.cart-items{
 max-height:200px;
 overflow:auto;
 font-size:14px;
}

.cart-item{
 display:flex;
 justify-content:space-between;
 margin-bottom:6px;
}

.cart-total{
 font-weight:700;
 font-size:16px;
 margin-top:8px;
}

.whatsapp-btn{
 background:#25D366;
 color:#fff;
 border:none;
 padding:10px;
 border-radius:10px;
 cursor:pointer;
 font-weight:600;
}

.footer{
 margin-top:30px;
 text-align:center;
 padding:16px;
 background:#e8f5e9;
}
</style>
</head>
<body>

<header>
 <div class="logo">WP</div>
 <div>
   <h2>White Pack</h2>
   <div>Professional Packaging</div>
 </div>
 <div class="topbar">
   WhatsApp: <a href="https://wa.me/96170333029" target="_blank">+961 70 333 029</a>
 </div>
</header>

<main class="container">
 <div class="section-title">Products</div>
 <div id="grid" class="grid"></div>
</main>

<!-- CART -->
<div class="cart">
 <h3>Your Order</h3>
 <div id="cartItems" class="cart-items"></div>
 <div id="cartTotal" class="cart-total">Total: 0 USD</div>
 <button class="whatsapp-btn" onclick="sendWhatsApp()">Send via WhatsApp</button>
</div>

<script>
const DATA_URL="products.json";
const RATE_KEY="internal_catalogue_usd_to_lbp";
let products=[];
let cart=[];

async function loadData(){
 const res=await fetch(DATA_URL+"?t="+Date.now());
 products=await res.json();
 render();
}

function getRate(){
 return Number(localStorage.getItem(RATE_KEY)||90000);
}

function render(){
 const grid=document.getElementById("grid");
 grid.innerHTML="";
 const rate=getRate();

 products.forEach((p,i)=>{
  const img=p.image
   ?`assets/images/products/${p.image}`
   :"assets/images/placeholder.jpg";

  const card=document.createElement("div");
  card.className="card";
  card.innerHTML=`
   <img src="${img}">
   <h4>${p.name}</h4>
   <div class="price">
    ${p.price} USD
    <small>${Math.round(p.price*rate).toLocaleString()} LBP</small>
   </div>
   <div class="qty-row">
    <div class="qty-box">
     <button onclick="changeQty(${i},-1)">-</button>
     <input id="qty-${i}" type="number" value="1" min="1">
     <button onclick="changeQty(${i},1)">+</button>
    </div>
    <button class="add-btn" onclick="addToCart(${i})">
     Add
    </button>
   </div>`;
  grid.appendChild(card);
 });
}

function changeQty(i,d){
 const inp=document.getElementById("qty-"+i);
 let v=parseInt(inp.value)||1;
 v+=d;if(v<1)v=1;
 inp.value=v;
}

function addToCart(i){
 const qty=parseInt(document.getElementById("qty-"+i).value)||1;
 const product=products[i];

 const existing=cart.find(c=>c.id===i);
 if(existing){
  existing.qty+=qty;
 }else{
  cart.push({id:i,name:product.name,price:product.price,qty});
 }

 updateCart();
}

function updateCart(){
 const cartItems=document.getElementById("cartItems");
 const cartTotal=document.getElementById("cartTotal");
 const rate=getRate();
 cartItems.innerHTML="";
 let total=0;

 cart.forEach((item,index)=>{
  const subtotal=item.price*item.qty;
  total+=subtotal;
  cartItems.innerHTML+=`
   <div class="cart-item">
    <span>${item.name} x${item.qty}</span>
    <span>${subtotal} USD</span>
   </div>`;
 });

 cartTotal.innerHTML=
  `Total: ${total.toFixed(2)} USD
   <br><small>${Math.round(total*rate).toLocaleString()} LBP</small>`;
}

function sendWhatsApp(){
 if(cart.length===0){
  alert("Cart is empty");
  return;
 }

 let message="Hello White Pack,%0A%0AI would like to order:%0A";
 let total=0;

 cart.forEach(item=>{
  const subtotal=item.price*item.qty;
  total+=subtotal;
  message+=`- ${item.name} x${item.qty} = ${subtotal} USD%0A`;
 });

 message+=`%0ATotal: ${total.toFixed(2)} USD`;

 window.open(`https://wa.me/96170333029?text=${message}`,"_blank");
}

loadData();
</script>

<div class="footer">
 <strong>White Pack</strong> — Premium Packaging Solutions
</div>

</body>
</html>